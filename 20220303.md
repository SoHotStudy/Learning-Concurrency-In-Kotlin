## 동시성 오류

멀티 쓰레드 환경에서는 여러 쓰레드가 공유되는 변수를 참조할 때 동시성 오류가 발생할 수 있다. 

이는 연산에 원자성이 없기 때문에 발생하는 문제이다.

### 원자성 위반

컴퓨터 입장에서 하나의 CPU 연산으로 처리될 수 있는 연산을 원자적이라고 한다.

`++` 연산은 아래와 같이 3가지 연산이 섞여 있기 때문에 원자적이지 않다.
- 메모리에서 변수의 값을 가져오는 연산
- 가져온 값을 증가시키는 연산
- 증가시킨 값을 메모리에 쓰는 연산

그렇기 때문에 여러 쓰레드가 공유되는 변수를 참조하여 `++` 연산을 할 때 아래 그림과 같이 값을 덮어쓰는 상황이 발생한다.

![image](https://user-images.githubusercontent.com/31586979/156486013-198853e7-db5e-47c6-9f21-6c47fd5360c1.png)

### Volatile

쓰레드는 CPU 위에서 동작하게 되고, CPU에서 메모리에 있는 데이터를 가져오기에는 너무 많은 시간이 소요된다.

시간 소요를 줄이기 위해 CPU는 메모리까지 가지 않아도 데이터를 알 수 있도록 L2 캐시를 이용한다.

그래서 A 쓰레드가 메모리의 있는 값을 업데이트 해도, B 쓰레드는 L2 캐시를 참조하고 있어 아직 A가 업데이트한 값을 모를 수 있다.

Volatile을 이용하여 이러한 상황을 회피할 수 있다.

Volatile은 L2 캐시를 이용하지 않고 직접 메모리에서 데이터를 가져다 쓰라고 지시한 것이기 때문에 항상 최신의 데이터를 읽어온다.

하지만 Volatile은 최신 데이터만 참고할 뿐이지 연산이 원자적이지 않으면 덮어쓰는 문제가 발생하기 때문에 Volatile이 모든 동시성 오류를 해결해줄 수 없다.

## Thread Safe

멀티 쓰레드 환경에서는 위에서 설명한 것과 같이 동시성 이슈가 발생할 수 있다.

이를 해결하기 위한 방법을 소개한다.

### Single Thread

여러 쓰레드가 하나의 변수를 참조하면 문제가 될 수 있다.

그렇다면 이를 회피하기 위한 가장 간단한 방법은 하나의 쓰레드만 해당 변수를 참조하고 변경하게 하면 된다.

이는 후에 설명할 Actor를 

### Atomic한 기본 자료형

## Actor

## Mutex
